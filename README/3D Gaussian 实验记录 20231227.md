<a name="WKZ3V"></a>
### baseline
**实验分支**：3D Gaussian 初始环境 main/main<br />**数据集来源**：来自 NeRFRen 中的 RFFR 数据集，其中 RFFR 预处理的数据采用的相机模型为 SPIRAL，3D GS 暂不支持该相机模型，因此对数据集进行重新预处理（通过COLMAP）为 PINHOLE 模型，进行训练

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| mirror_r4_base | resolution: 4 | PSNR: 31.5807 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703660971751-78698b48-27a7-4095-9309-b4809e67adb5.png#averageHue=%238d8377&clientId=ub1a6c335-b3eb-4&from=paste&height=352&id=u60632021&originHeight=703&originWidth=1533&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1373362&status=done&style=none&taskId=u629a053a-7e55-4c6f-808e-69947eb3c9a&title=&width=766.5) | <br />1. 2000个iteration时就能达到比较好的效果；<br />2. 训练集上几乎没有问题，**测试集上镜子边缘部分会出现artifact**<br /> |
| tv_r4_base | resolution: 4 | PSNR: 34.59900 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703661378401-6fa48583-1a2a-407c-bf38-4d8a3de92fa8.png#averageHue=%23726b63&clientId=ue70d2a70-7f87-4&from=paste&height=363&id=u77730bd8&originHeight=725&originWidth=1515&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1248800&status=done&style=none&taskId=u0ebd68da-fcf6-4bee-a166-406d3604015&title=&width=757.5) | <br />1. 同样的在2000个iteration就能得到比较好的结果；<br />2. 存在的问题为：测试集上某些view边缘artifact比较严重，电视机里的镜面反射不够完美（虽然已经很好了）<br /> |
| art2_r4_base | resolution: 4 | PSNR: 26.8888 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703661521453-06cff029-1abe-4a8b-b480-3f630dcf6935.png#averageHue=%2393908b&clientId=ue70d2a70-7f87-4&from=paste&height=383&id=ue889cffc&originHeight=765&originWidth=1511&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1399934&status=done&style=none&taskId=uf2c80c66-554a-496c-ab87-e4c508731a0&title=&width=755.5) | <br />1. 测试集上某些view的artifact比较严重，而且玻璃上的镜面反射不如训练集<br /> |

在这个三个baseline实验中，均发现在2000个iteration就能取得比较好的结果，并且在prune以及reset opacity后30000个iteration的结果对比2000个甚至有所下降，因此尝试了去除了prune和reset opacity的步骤后的baseline实验

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| art2_r4_base_wo_reset | resolution: 4<br />去除了prune和reset opacity的步骤 | PSNR: 35.9915 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703662002054-d32bc99e-e496-428e-8af4-3deac89da0d9.png#averageHue=%2397938e&clientId=uc07881fa-1402-4&from=paste&height=377&id=u6a87cfa8&originHeight=753&originWidth=1513&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1147991&status=done&style=none&taskId=u2765fc3b-56c2-49ca-ad19-1d5edfe7bd0&title=&width=756.5) | <br />1. 确实在测试集上普遍表现更好；<br />2. 细节处的渲染不够好，如图中玻璃反射门的影子<br /> |

**总结：**

1. **3D GS 目前在这几个数据集上的问题都不太明显，但是反射部分明显还有可以改进的地方；**
2. **3D GS 的 prune 和 reset opactiy 操作会明显给渲染图像增加更多的细节；**
<a name="ged9X"></a>
### 实验记录
<a name="OaTNA"></a>
#### merge all
将目前所有添加的 tricks 合并，然后训练，包括：

- 将color拆分为transmitted和reflected部分，并通过 final_color = trans_color + ref_color * ref_map 的形式组合
- 添加模型渲染的 depth 和通过预训练单目模型估测的 depth 之间的 depth prior loss（pearson correlation）
- 添加 depth 和 reflection map 的 smooth loss
- 添加 forward_to_back depth 和 back_to_forward depth 之间的 l1 loss（bdc loss）
| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| mirror_r4_all | resolution: 4;<br />depth prior loss weight: 0.05;<br />depth smooth loss weight: 0.01;<br />ref map smooth weight: 0.1;<br />bdc loss weight: 0.001;  | PSNR: 27.3733 | ![1703664509163.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703664518205-12ab9e20-421e-4116-92fe-86a42191c87b.png#averageHue=%23c3c1bf&clientId=uc07881fa-1402-4&from=paste&height=730&id=u75c31d05&originHeight=1459&originWidth=2013&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2086743&status=done&style=none&taskId=u30028273-61b8-4b4c-b43e-211b3dbaa7f&title=&width=1006.5) | <br />1. 渲染效果较差；<br />2. 预训练模型预测的depth信息很重要，而这个信息在此数据集中不是很准确，影响了渲染的depth<br /> |

去掉 depth prior loss 后再进行实验

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| mirror_r4_all_remove_depth_prior | resolution: 4;<br />depth smooth loss weight: 0.01;<br />ref map smooth weight: 0.1;<br />bdc loss weight: 0.001;  | PSNR: 25.5708 | ![1703666851571.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703666867984-317a2f36-10f5-426a-ad3f-11c1e4b73f83.png#averageHue=%23cac7c4&clientId=uc07881fa-1402-4&from=paste&height=730&id=uc8a66155&originHeight=1459&originWidth=2055&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2001651&status=done&style=none&taskId=ufe2d2a05-0b3f-4985-be26-ee44a378416&title=&width=1027.5) | <br />1. 渲染效果较差；ref map 没有轮廓<br /> |
| art2_r4_all_remove_depth_prior | resolution: 4;<br />depth smooth loss weight: 0.01;<br />ref map smooth weight: 0.1;<br />bdc loss weight: 0.001;  | PSNR: 23.73 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703729113794-7c8c75b9-f8c6-4fc0-97af-844c85428522.png#averageHue=%23a3a19f&clientId=u86ddafbb-7d46-4&from=paste&height=721&id=u46729383&originHeight=1441&originWidth=1995&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1845721&status=done&style=none&taskId=ue28074af-23e4-4588-8a0c-85ffaaa1057&title=&width=997.5) | <br />1. 渲染效果很差<br /> |
| art2_r4_all_remove_depth_prior_1 | resolution: 4;<br />depth smooth loss weight: 0.01;<br />ref map smooth weight: 0.1;<br />bdc loss weight: 0.001;  | PSNR: 26.4016 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703729113794-7c8c75b9-f8c6-4fc0-97af-844c85428522.png#averageHue=%23a3a19f&clientId=u86ddafbb-7d46-4&from=paste&height=721&id=qu8Hj&originHeight=1441&originWidth=1995&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1845721&status=done&style=none&taskId=ue28074af-23e4-4588-8a0c-85ffaaa1057&title=&width=997.5) | <br />1. 修复了下面那个bug之后重新发起的实验；<br />2. 渲染效果很差<br /> |

<a name="ZmMUX"></a>
#### bug 修复
**修复了 forward 和 backward 过程中 reflection alpha (opacity) 计算的bug**<br />forward:<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703672232388-27a75e32-15d3-481d-b858-e5fee06f6c12.png#averageHue=%23fefcfc&clientId=uc07881fa-1402-4&from=paste&height=274&id=ud2ed48ad&originHeight=547&originWidth=2005&originalType=binary&ratio=2&rotation=0&showTitle=false&size=138653&status=done&style=none&taskId=u021cfec6-8a91-4a15-82d3-c024c573f1d&title=&width=1002.5)<br />backward:![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703672255989-be06a948-fca9-42a1-bb5e-d0025081e75d.png#averageHue=%23fefcfb&clientId=uc07881fa-1402-4&from=paste&height=250&id=u0471ac65&originHeight=499&originWidth=2001&originalType=binary&ratio=2&rotation=0&showTitle=false&size=121873&status=done&style=none&taskId=u9f3fb42a-ba61-43fd-8817-51df40479a2&title=&width=1000.5)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703672272938-5c41463f-4fb3-4714-9e00-75d636f1a2f4.png#averageHue=%23d2ba8c&clientId=uc07881fa-1402-4&from=paste&height=647&id=u82055c26&originHeight=1293&originWidth=1945&originalType=binary&ratio=2&rotation=0&showTitle=false&size=391563&status=done&style=none&taskId=u4b0e1e11-ae2e-4ab3-914a-6d27e59a17f&title=&width=972.5)<br />修复bug后，在只有 reflection 的分支上发起了实验<br />实验分支：exp_add_reflection_1/exp_add_reflection_cuda_2

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| room_r4_refl_new | resolution: 4; | PSNR: 30.3047 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703673363556-27ccdcd8-3334-4f67-ab4a-c461e4b6ef92.png#averageHue=%23b1aca3&clientId=uc07881fa-1402-4&from=paste&height=542&id=ud41a256e&originHeight=1083&originWidth=2075&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2186114&status=done&style=none&taskId=u1bf0a144-c3ad-4426-9e16-57adb41289b&title=&width=1037.5) | <br />1. metrics 区别不大<br />2. color 的拆分依旧做得不好；<br />3. ref map 需要平滑<br /> |

**尝试像 trans color 那样根据 ref 的 alpha 和 T 做一些过滤，以及将 ref map 作用于 trans color**<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703673812317-e0296990-99dd-4ae2-960b-1e3cedb32282.png#averageHue=%23fdf9f8&clientId=uc07881fa-1402-4&from=paste&height=88&id=u7149ee1f&originHeight=175&originWidth=1475&originalType=binary&ratio=2&rotation=0&showTitle=false&size=39257&status=done&style=none&taskId=ud80276fb-f910-4aaf-8346-eed3548e926&title=&width=737.5)

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| room_r4_refl_filter | resolution: 4; | PSNR: 16.6334 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703675058435-68339b46-d7b9-487f-a27d-787032e586cb.png#averageHue=%23b8b2a5&clientId=uc07881fa-1402-4&from=paste&height=497&id=vAkyC&originHeight=993&originWidth=2139&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2354558&status=done&style=none&taskId=ude04bf0d-37f5-40d1-a92c-cc95bb17b09&title=&width=1069.5) | <br />1. metrics 降低很多；<br />2. ref map 需要平滑处理<br /> |

只加过滤

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| room_r4_refl_filter_1 | resolution: 4; | PSNR: 32.0885 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703677015839-5e1971b6-60d7-483c-a1d2-dce8b61989d3.png#averageHue=%23aea9a0&clientId=uc07881fa-1402-4&from=paste&height=505&id=u476a141f&originHeight=1009&originWidth=2069&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2179003&status=done&style=none&taskId=ucb0cf91a-9c90-4014-8fbe-0d4974feb89&title=&width=1034.5) | <br />1. metrics 略微提升；<br />2. color 的拆分依旧不是很好<br /> |

**然后加上 ref map smooth loss**

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| room_r4_refl_smooth | resolution: 4; | PSNR: 31.9263 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703679332778-f930ceb3-8640-420a-8fd7-5c91323a444d.png#averageHue=%23a29c90&clientId=uc07881fa-1402-4&from=paste&height=521&id=ub731d854&originHeight=1041&originWidth=1995&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2292507&status=done&style=none&taskId=uabf1babb-e8bc-476c-85cd-f06ec4b5744&title=&width=997.5) | 没啥区别 |

<a name="Z6Oc1"></a>
#### 关于 simple_radial 数据集
simple_radial 相机模型的数据集（如 RFFR），相比于 pinhole/simple_pinhole 这些 3D GS 支持的数据集，相机内参多了一个畸变系数 k：<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703742293792-7793cd61-6fbd-4295-8ab0-45d657dd73f3.png#averageHue=%23f4f3f3&clientId=u86ddafbb-7d46-4&from=paste&height=266&id=u25be259f&originHeight=531&originWidth=1075&originalType=binary&ratio=2&rotation=0&showTitle=false&size=50717&status=done&style=none&taskId=ub7f162d2-8658-47fe-9fd5-243dde60779&title=&width=537.5)<br />根据[知乎用户](https://www.zhihu.com/question/622078994/answer/3211407099)，加上该畸变系数后坐标计算公式为：<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703742377293-1af1b018-5047-497c-b263-2b56d995410d.png#averageHue=%23fefdfc&clientId=u86ddafbb-7d46-4&from=paste&height=349&id=u555ca0d2&originHeight=697&originWidth=1351&originalType=binary&ratio=2&rotation=0&showTitle=false&size=176086&status=done&style=none&taskId=uf4cd5e99-381c-477e-9b73-e5a4166fd45&title=&width=675.5)<br />针对为什么不支持非 pinhole 相机模型，作者在 [issue](https://github.com/graphdeco-inria/gaussian-splatting/issues/303) 中给出了原因，并且提到 COLMAP 可以将 no-pinhole 模型转换为 pinhole 模型：<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703742634453-e6f5297f-72c2-4227-b5d4-322331e3aa16.png#averageHue=%23fdfcfa&clientId=u86ddafbb-7d46-4&from=paste&height=130&id=uc4e47b10&originHeight=259&originWidth=1691&originalType=binary&ratio=2&rotation=0&showTitle=false&size=61897&status=done&style=none&taskId=ufca5e6ec-f0ba-4eee-a9bc-c4fa8e0d53a&title=&width=845.5)
<a name="GtSA6"></a>
##### 忽略畸变系数，直接将 simple_pinhole 的计算方法套用到 simple_radial 上
具体实现为：<br /> <br />这是最开始采用的方法，从直觉上说这样的方法回损害方法性能，在 bookcase 上的实验结果：

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| bookcase_r4_refl_1 | resolution: 4; | PSNR: 27.5216 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703742969584-aa1c71c2-abcf-443d-a5b4-8b95785fd19d.png#averageHue=%23413729&clientId=u86ddafbb-7d46-4&from=paste&height=500&id=u40a078d8&originHeight=999&originWidth=2069&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2233744&status=done&style=none&taskId=u5a6ed6e2-f364-4cd8-a4b7-e94ef5edd4b&title=&width=1034.5) | 镜面部分很模糊，几乎没有细节 |

<a name="enn1o"></a>
##### 将原数据集中的 images 重新经过 COLMAP 进行稀疏重建
实验结果：

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| bookcase_r4_refl | resolution: 4; | PSNR: 30.8675 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703743099919-0bd40f54-406f-4bbc-aadf-d393beff3f6a.png#averageHue=%233a3026&clientId=u86ddafbb-7d46-4&from=paste&height=505&id=u03d996e6&originHeight=1009&originWidth=1993&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2149450&status=done&style=none&taskId=u68a3f997-f97e-48ed-9496-32b105cb182&title=&width=996.5) | 镜面部分的细节依旧不够，但比上一个处理方法要好 |

<a name="j6XcO"></a>
##### 将原数据集的 cameras, images, point3d 信息通过 COLMAP 进行 undistortion
与上一个方法的区别是在 convert.py 过程中设置了 --skip_matching<br />实验结果：

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| bookcase_r4_refl_2 | resolution: 4; | PSNR: 29.4407 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703744424717-88321e6f-b08e-4877-aa18-33376f0a6f7c.png#averageHue=%233c3229&clientId=u86ddafbb-7d46-4&from=paste&height=492&id=udb1a0594&originHeight=983&originWidth=2001&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2175638&status=done&style=none&taskId=u15f1f1a7-ac54-4e49-b61f-0bc6c0625e5&title=&width=1000.5) | metrics 比上一个差，镜面部分的细节也要差一点 |

**总结：**

1. **总体来说第二种方法，也就是将 images 重新经过 COLMAP 处理得到的效果最好**
<a name="h8Ukt"></a>
#### 关于 reset 和 prune 的效果
在训练过程中发现在有些数据集上 reset opacity 后 metrics 下降严重，直到训练结束 metrics 可能都赶不上 reset 之前的 metrics，因此尝试了在添加了 reflection 之后不 reset opacity 以及 prune，实验结果：

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| bookcase_r4_refl_wo_reset | resolution: 4; | PSNR: 31.4227 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703746182732-7a80c9b2-4d9c-4ea6-b991-d7f33d8c1760.png#averageHue=%23322921&clientId=u86ddafbb-7d46-4&from=paste&height=499&id=ucf9ca0d7&originHeight=997&originWidth=1969&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1799297&status=done&style=none&taskId=uc24d57b7-1d58-4432-96b8-2710cfa7aea&title=&width=984.5) | <br />1. metrics 会好一点；<br />2. 同样的细节处理不够，说明需要更多 GS<br /> |

尝试减小iteration数到 10000，并且在 1000 个 iteration 时进行 reset

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| bookcase_r4_refl_10000 | resolution: 4; | PSNR: 15.5639 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703748077856-ca0ac53a-71bd-46b0-b689-72820eb7f481.png#averageHue=%239b9997&clientId=u86ddafbb-7d46-4&from=paste&height=531&id=u88226b35&originHeight=1061&originWidth=2035&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1515134&status=done&style=none&taskId=u68d916d1-48ef-462c-809a-cf6b2021fbd&title=&width=1017.5) | <br />1. 效果很差<br />2. GS 数目以及 iterations 数都不够<br /> |

<a name="l65LG"></a>
#### 根据 NeRFRen 的训练技巧进行实验
数据集：bookcase<br />NeRFRen 的 training details：<br />1）在前1000个iteration（一共 5000 个）让trans color与gt image对齐；<br />2）给 ref map 也添加 smooth loss；<br />3）warm up training，对于两个 depth prior loss 权重的调整策略；<br />4）ReLU 作为 beta 的激活函数
<a name="VHmal"></a>
###### baseline
训练分支：main/exp_visualize_depth

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| bookcase_r4_base | resolution: 4; | PSNR: 32.5108 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703750142457-06daf347-afe4-48f0-8dee-548b07590c90.png#averageHue=%23a7a5a4&clientId=u86ddafbb-7d46-4&from=paste&height=548&id=uffa2f6e5&originHeight=1095&originWidth=1513&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1635020&status=done&style=none&taskId=ud3d072c0-17c5-4eab-b65d-44f9bc346e9&title=&width=756.5) | <br />1. 镜面部分呈现雾状，反射细节不是很好<br /> |

加了 reflection 的 baseline

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| bookcase_r4_refl | resolution: 4; | PSNR: 30.8675 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703743099919-0bd40f54-406f-4bbc-aadf-d393beff3f6a.png#averageHue=%233a3026&clientId=u86ddafbb-7d46-4&from=paste&height=505&id=aTsqv&originHeight=1009&originWidth=1993&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2149450&status=done&style=none&taskId=u68a3f997-f97e-48ed-9496-32b105cb182&title=&width=996.5) | 镜面部分依旧呈现雾状 |

<a name="F8XYk"></a>
###### stabilized training
在前 n 个 iteration让trans color与gt image对齐；

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| bookcase_r4_refl_init_1000 | resolution: 4;<br />n: 1000; | PSNR: 31.7242 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703752819725-7973594e-7b29-405f-b406-8486aa529c6b.png#averageHue=%23aeacab&clientId=u86ddafbb-7d46-4&from=paste&height=517&id=u94e73d3c&originHeight=1033&originWidth=2057&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1958367&status=done&style=none&taskId=ub25ac782-bc88-4a0c-b5e6-f42602939ed&title=&width=1028.5) | <br />1. ref color 作用不大<br /> |
| bookcase_r4_refl_init_6000 | resolution: 4;<br />n: 6000; | PSNR: 30.1071 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703754104262-8a74b4ef-521c-48fc-b796-1c8f8ea842aa.png#averageHue=%23a2a09e&clientId=u86ddafbb-7d46-4&from=paste&height=491&id=uc70f10bf&originHeight=981&originWidth=1949&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1741974&status=done&style=none&taskId=u176b38e4-6653-4d5d-ba42-9aa29aa6cb6&title=&width=974.5) | <br />1. ref color 占比进一步缩小了<br /> |
| bookcase_r4_refl_init_3000 | resolution: 4;<br />n: 3000; | PSNR: 29.0799 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703755580753-4911a6f6-24b2-45c7-8a4f-ad0464437c75.png#averageHue=%23aca9a8&clientId=u86ddafbb-7d46-4&from=paste&height=500&id=u7a629307&originHeight=999&originWidth=1983&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1802610&status=done&style=none&taskId=u95082aaf-f853-4e60-95f8-465137939ad&title=&width=991.5) | <br />1. ref color 占比依旧很小；<br />2. 看起来效果最差<br /> |
| bookcase_r4_refl_init_l1_1000 | resolution: 4;<br />n: 1000;<br />l1 loss | PSNR:30.3010 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703757075786-29d45b07-66f2-40dd-b955-75f5e3fcb076.png#averageHue=%23b0adab&clientId=u86ddafbb-7d46-4&from=paste&height=512&id=ubdff18c5&originHeight=1023&originWidth=2053&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1887731&status=done&style=none&taskId=u3b555b3f-279b-4218-a72a-453b4157ca3&title=&width=1026.5) | <br />1. 对比使用 l2 loss，效果变差<br /> |

<a name="dZLYZ"></a>
###### 关于 beta 的初始值和激活函数的选择
去除 beta 的 inverse_activation_func:

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| bookcase_r4_refl_beta_iden | resolution: 4; | PSNR: 30.6466 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703761649276-f18721b1-2716-4175-998f-8aca5b38a827.png#averageHue=%23bebdbb&clientId=u86ddafbb-7d46-4&from=paste&height=522&id=u30a4f3c1&originHeight=1043&originWidth=2247&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1921524&status=done&style=none&taskId=u4b0af2c0-09f3-4dab-b2cd-09c0f5e83f5&title=&width=1123.5) | <br />1. 看起来区别不大<br /> |

在 reset opacity 时不对 beta 进行 reset

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| bookcase_r4_refl_wo_beta_reset | resolution: 4;<br /> | PSNR: 31.1988 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703761529505-e94d1f8a-815a-44b6-925f-a9e60add53e8.png#averageHue=%23b7b5b4&clientId=u86ddafbb-7d46-4&from=paste&height=482&id=u0254695f&originHeight=963&originWidth=2015&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1583899&status=done&style=none&taskId=ub8606569-a898-4159-8b44-d354ac934aa&title=&width=1007.5) | <br />1. ref color 白色部分占比比较多；<br />2. 出现了大量光斑（大的高斯？）<br /> |
| bookcase_r4_refl_beta_0.5_wo_reset | resolution: 4;<br />beta init: 0.5; | PSNR: 29.9245 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703837377836-88f5e746-7645-4bfa-b10b-0981653b2505.png#averageHue=%23afadac&clientId=u86ddafbb-7d46-4&from=paste&height=507&id=u43b5c53f&originHeight=1013&originWidth=2045&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1907600&status=done&style=none&taskId=ue56e5c56-3082-4af2-86fa-6534460daa6&title=&width=1022.5) |  |
| bookcase_r4_refl_beta_0.01_wo_reset | resolution: 4;<br />beta init: 0.01; | PSNR: 30.4747 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703836935114-3359cbe2-01b6-4a3e-b5e9-5ac92ea72985.png#averageHue=%23b3b1af&clientId=u86ddafbb-7d46-4&from=paste&height=502&id=u43bb8504&originHeight=1003&originWidth=2023&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1971217&status=done&style=none&taskId=u4ed2bca3-c6e1-43ce-a3e9-a7eff46c2a6&title=&width=1011.5) |  |

调整 beta 初始值，以及 reset 最大值：

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| bookcase_r4_refl_beta_0.1 | resolution: 4;<br />beta init: 0.1; <br />reset: 0.01;  | PSNR: 30.0098 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703763315873-e59ed33b-86bb-4dc5-b663-f91c2bf15688.png#averageHue=%23b2b0ae&clientId=u86ddafbb-7d46-4&from=paste&height=520&id=D8W2r&originHeight=1039&originWidth=2035&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1803023&status=done&style=none&taskId=ube5982ac-40a7-4b7e-bf13-e20de4ead6c&title=&width=1017.5) | <br />1. 边缘处颜色不对<br /> |
| bookcase_r4_refl_beta_0.5 | resolution: 4;<br />beta init: 0.5;<br />reset: 0.01;  | PSNR: 30.4064 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703829641086-70023727-64e6-4344-b019-c904c6851034.png#averageHue=%23aca9a7&clientId=u86ddafbb-7d46-4&from=paste&height=500&id=NHJts&originHeight=999&originWidth=2031&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1825417&status=done&style=none&taskId=uf7d998bc-e2c3-4aba-8c03-fec81be6f39&title=&width=1015.5) |  |
| bookcase_r4_refl_beta_0.5_0.1 | resolution: 4;<br />beta init: 0.5;<br />reset: 0.1;  | PSNR: 30.7133 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703831556016-7e386f6d-b6ce-4238-82b7-638c12fbca37.png#averageHue=%23aba8a6&clientId=u86ddafbb-7d46-4&from=paste&height=500&id=rIkl9&originHeight=999&originWidth=1987&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1902923&status=done&style=none&taskId=u98409784-fded-4200-ab2f-148f05f4132&title=&width=993.5) |  |
| bookcase_r4_refl_beta_0.01_0.01 | resolution: 4;<br />beta init: 0.01;<br />reset: 0.01;  | PSNR: 30.2269 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703833552905-63be8c8c-3e3e-4208-84a3-810d786a6ae8.png#averageHue=%23b0aeac&clientId=u86ddafbb-7d46-4&from=paste&height=501&id=Fjwrh&originHeight=1001&originWidth=2111&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1801715&status=done&style=none&taskId=u87d308de-8885-4979-8bac-971a6ea86c7&title=&width=1055.5) | <br />1. ref map 几乎全黑<br /> |
| bookcase_r4_refl_beta_1_1 | resolution: 4;<br />beta init: 1;<br />reset: 1; <br />(效果应该相当于不 reset) | PSNR: 30.37 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703901424481-d788ad21-8a35-42aa-8a2e-05382ad63970.png#averageHue=%23b3b1b0&clientId=u24f9f5ec-a826-4&from=paste&height=502&id=u147e3fdd&originHeight=1003&originWidth=1995&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1568853&status=done&style=none&taskId=u4faea91f-86dc-422e-bcab-38a323c45c8&title=&width=997.5) | 效果确实和不 reset  差不多 |
| bookcase_r4_refl_beta_1_0.5 | resolution: 4;<br />beta init: 1;<br />reset: 0.5;  | PSNR: 30.70 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703901495792-48c37203-56a2-4b95-8d6c-b297902469ac.png#averageHue=%23b1afae&clientId=u24f9f5ec-a826-4&from=paste&height=517&id=ud3ecae61&originHeight=1033&originWidth=1983&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1908133&status=done&style=none&taskId=u405ca877-f651-4dc8-878d-d8774371fa7&title=&width=991.5) |  |
| bookcase_r4_refl_beta_1_0.01 | resolution: 4;<br />beta init: 1;<br />reset: 0.01;  | PSNR: 30.9704 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703903128810-9676854c-8249-4d1c-b4ec-af3d71bf65c0.png#averageHue=%23adaaa9&clientId=u24f9f5ec-a826-4&from=paste&height=493&id=u2a5407dc&originHeight=985&originWidth=2025&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1931935&status=done&style=none&taskId=uc6eeec91-58d5-4035-960b-f1835bf3145&title=&width=1012.5) |  |

<a name="MMCdJ"></a>
#### bookcase, iteration=5000
baseline:<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703904284277-f40ef71f-226e-44fc-91c4-cb46cbdb291f.png#averageHue=%23fef9f8&clientId=u24f9f5ec-a826-4&from=paste&height=329&id=u4d75325c&originHeight=657&originWidth=2071&originalType=binary&ratio=2&rotation=0&showTitle=false&size=182844&status=done&style=none&taskId=u31eda637-4092-49c4-9826-957793012a8&title=&width=1035.5)

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| bookcase_r4_iter_5000 | resolution: 4; | PSNR: 31.9615 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703904452260-c4897522-38fc-4242-8b9e-ab7de77d2aa6.png#averageHue=%23acaaa9&clientId=u24f9f5ec-a826-4&from=paste&height=553&id=u162f58ba&originHeight=1105&originWidth=1569&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1704857&status=done&style=none&taskId=u929dac04-8a43-4f1a-a9ac-db038402bf3&title=&width=784.5) | <br />1. 对比 30000 个 iteration 雾面部分更少；loss 下降也更合理<br /> |

**加了 reflection 之后：**

| **training 目录** | **参数调整** | **metrics**<br />**(test/30000)** | **tensorboard** | **总结** |
| --- | --- | --- | --- | --- |
| bookcase_r4_refl_iter_5000 | resolution: 4;<br />beta init: 1;<br />reset: 0.1; | PSNR: 30.0809 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703911946124-219ab861-6b9d-4e7b-983a-2c9202c130cf.png#averageHue=%23b1b0ae&clientId=u24f9f5ec-a826-4&from=paste&height=519&id=ua04b119a&originHeight=1037&originWidth=1985&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2061942&status=done&style=none&taskId=uf1321b6f-54a9-4115-a87c-2e455cd0963&title=&width=992.5) |   |
| bookcase_r4_refl_iter_5000_filter | resolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />(cuda中加了关于 ref color 的过滤条件) | PSNR: 32.2214 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703912026070-67dd7784-a25e-40f6-8fd3-8a17093be907.png#averageHue=%23b2b0af&clientId=u24f9f5ec-a826-4&from=paste&height=500&id=ub8c11332&originHeight=999&originWidth=2021&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2032061&status=done&style=none&taskId=ub5c9c335-92ea-48bd-a3f8-482a6d46a3e&title=&width=1010.5) | <br />1. trans color 和 ref color 依旧分得不是很开，ref color 部分关于灯光有所提升；<br /> |
| bookcase_r4_refl_iter_5000_wo_beta_reset | resolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />(cuda中加了关于 ref color 的过滤条件；不 reset beta) | PSNR: 30.9398 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703912869271-0c675f7c-310e-420c-8c7f-fa81c80ccf84.png#averageHue=%23bbb9b8&clientId=u24f9f5ec-a826-4&from=paste&height=517&id=u2c53f53e&originHeight=1033&originWidth=2005&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1747686&status=done&style=none&taskId=ub2168cd3-aaff-4d49-81a7-5f7dd4c66ba&title=&width=1002.5) |  |
| bookcase_r4_refl_iter_5000_init_1000 | esolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />(cuda中加了关于 ref color 的过滤条件；前 1000 个 iteration 加入 trans color 与 gt image 的 l2 loss) | PSNR: 31.64 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703915442587-2808e63a-f1bf-40f6-bd68-d5fdfab9df5f.png#averageHue=%23afadab&clientId=u24f9f5ec-a826-4&from=paste&height=498&id=u3d0834df&originHeight=995&originWidth=1997&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2040661&status=done&style=none&taskId=u0b8504f8-a3e4-4658-929d-4547b1cbab2&title=&width=998.5) | <br />1. ref color 的占比明显减小<br /> |
| bookcase_r4_refl_iter_5000_init_1000_0.01 | esolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />(cuda中加了关于 ref color 的过滤条件；前 1000 个 iteration 加入 trans color 与 gt image 的 l2 loss，weight 为 0.01) | PSNR: 31.5141 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703916955199-0f722546-25cb-4911-aae0-9cb3a60f30e2.png#averageHue=%23b1afae&clientId=u24f9f5ec-a826-4&from=paste&height=500&id=uf7425abc&originHeight=999&originWidth=2031&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2030104&status=done&style=none&taskId=u2a9fe69b-be52-4e1f-8847-e6ec01881c1&title=&width=1015.5) |  |
| bookcase_r4_refl_iter_5000_init_500_0.01 | esolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />(cuda中加了关于 ref color 的过滤条件；前 500 个 iteration 加入 trans color 与 gt image 的 l2 loss，weight 为 0.01) | PSNR: 31.6266 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703917768184-05818293-d7ed-443f-a117-2e58b04ef8d9.png#averageHue=%23b4b2b0&clientId=u24f9f5ec-a826-4&from=paste&height=498&id=u15b85e5e&originHeight=995&originWidth=1999&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2042201&status=done&style=none&taskId=u77627368-6f09-4975-b933-a0c33a2b62b&title=&width=999.5) |  |
| bookcase_r4_refl_iter_5000_sh_150 | resolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />(cuda中加了关于 ref color 的过滤条件；sh 每 150 个 iter degree+1） | PSNR: 31.0353 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703915220823-b2227001-fbd1-4562-a2fb-ce3a2fae13f1.png#averageHue=%23b2b1af&clientId=u24f9f5ec-a826-4&from=paste&height=520&id=uf8689a89&originHeight=1039&originWidth=1997&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1997537&status=done&style=none&taskId=ub4e8115b-885b-4d17-b3de-8fe05edc7c2&title=&width=998.5) | <br />1. 似乎与 1000 个 iter sh degree +1 区别不大<br /> |

**设置 trans color 的 lowpass loss**

| bookcase_r4_refl_iter_5000_init_1000 | esolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />init: 1000; <br /> | PSNR: 31.64 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703915442587-2808e63a-f1bf-40f6-bd68-d5fdfab9df5f.png#averageHue=%23afadab&clientId=u24f9f5ec-a826-4&from=paste&height=498&id=Czyqk&originHeight=995&originWidth=1997&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2040661&status=done&style=none&taskId=u0b8504f8-a3e4-4658-929d-4547b1cbab2&title=&width=998.5) | <br />1. ref color 的占比明显减小<br /> |
| --- | --- | --- | --- | --- |
| bookcase_r4_refl_iter_5000_init_1000_0.01 | esolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />init: 1000(0.01); | PSNR: 31.5141 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703916955199-0f722546-25cb-4911-aae0-9cb3a60f30e2.png#averageHue=%23b1afae&clientId=u24f9f5ec-a826-4&from=paste&height=500&id=DCLOV&originHeight=999&originWidth=2031&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2030104&status=done&style=none&taskId=u2a9fe69b-be52-4e1f-8847-e6ec01881c1&title=&width=1015.5) | <br /> |
| bookcase_r4_refl_iter_5000_init_500_0.01 | esolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />init: 500(0.01); | PSNR: 31.6266 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703917768184-05818293-d7ed-443f-a117-2e58b04ef8d9.png#averageHue=%23b4b2b0&clientId=u24f9f5ec-a826-4&from=paste&height=498&id=MnD0C&originHeight=995&originWidth=1999&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2042201&status=done&style=none&taskId=u77627368-6f09-4975-b933-a0c33a2b62b&title=&width=999.5) | <br /> |

增加 ref map 的 smooth loss

| bookcase_r4_refl_iter_5000_init_500_0.01_refmap_smooth | esolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />init: 500(0.01);<br />smooth: 0.01 | PSNR: 30.8389 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703919738322-b0d6b695-08ae-411f-be10-caf5f525643f.png#averageHue=%23b3b2b0&clientId=u24f9f5ec-a826-4&from=paste&height=513&id=u72872aa0&originHeight=1025&originWidth=2021&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2026565&status=done&style=none&taskId=u8e2957eb-046a-4195-810b-47a90dcf491&title=&width=1010.5) | <br /> |
| --- | --- | --- | --- | --- |
| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_smooth_0.0001 | esolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />init: 1000(0.01);<br />smooth: 0.0001 | PSNR: 31.4166 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703920348100-cf7b8caa-b3fc-4e9e-aa03-8c36da41d4f7.png#averageHue=%23b4b2b1&clientId=u24f9f5ec-a826-4&from=paste&height=504&id=udfac1024&originHeight=1007&originWidth=2027&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2034529&status=done&style=none&taskId=ubc7b93da-a31f-4b4f-92da-ee1c4adb24f&title=&width=1013.5) |  |
| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_smooth_edge_0.0001 | esolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />init: 1000(0.01);<br />smooth: 0.0001(使用EdgePerservingSmooth) | PSNR: 31.6062 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703921144437-27e64d37-9827-4f29-a5a1-13772c622ca4.png#averageHue=%23b0aead&clientId=u24f9f5ec-a826-4&from=paste&height=503&id=WO1Hu&originHeight=1005&originWidth=2007&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2011299&status=done&style=none&taskId=uad8c78c9-332a-400b-8240-c5c83d386b3&title=&width=1003.5) |  |
| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_smooth_edge_0.1 | esolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />init: 1000(0.01);<br />smooth: 0.1(使用EdgePerservingSmooth) | PSNR: 31.2824 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703923986570-f53d4d5c-2c29-4ec1-a99d-89940a4a7e6f.png#averageHue=%23b8b6b5&clientId=u24f9f5ec-a826-4&from=paste&height=507&id=u20543012&originHeight=1013&originWidth=2113&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2012842&status=done&style=none&taskId=u014a7947-7aa2-41e1-a356-da08272a398&title=&width=1056.5) | <br />1. ref map 更光滑，但是依旧不准确<br /> |

增加 depth smooth loss

| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_0.0001_depthsmooth_0.0001 | esolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 1e-4; <br />depth smooth(edge perserving): 1e-4;  | PSNR: 32.2848 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703926459280-a71cae11-b127-4714-acac-9d17a2b58c95.png#averageHue=%23b0aead&clientId=u24f9f5ec-a826-4&from=paste&height=504&id=u9e05443c&originHeight=1007&originWidth=1991&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2048789&status=done&style=none&taskId=u81b2bbf0-3c26-4312-bd17-81e8c5e5d71&title=&width=995.5) |  |
| --- | --- | --- | --- | --- |
| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_0.001_depthsmooth_0.0005 | esolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.001; <br />depth smooth(edge perserving): 0.0005;  | PSNR: 29.4586 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703930143890-fb1dba34-3744-47a3-9b21-ce6c834e3457.png#averageHue=%23c0bfbe&clientId=u71f46a30-a87e-4&from=paste&height=508&id=u7ae28b90&originHeight=1015&originWidth=2463&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2127317&status=done&style=none&taskId=u07cf7604-1e83-4ce4-a637-1f597414afa&title=&width=1231.5) |  |
| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_0.001_depthsmooth_0.0001_rand_beta_wo_filter | esolution: 4;<br />beta init: rand;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.0001;  | PSNR: 28.9239 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704270202309-e6639a38-7b6c-4e58-935e-976774995a4c.png#averageHue=%23afadac&clientId=ua8c80b52-580c-4&from=paste&height=509&id=u7a07c9a3&originHeight=1017&originWidth=2001&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2096123&status=done&style=none&taskId=ufba7b867-611f-4e51-bdd5-763c8056b62&title=&width=1000.5) |  |

增加 bdc loss

| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_0.0001_depthsmooth_0.0001_bdc_0.0001 | esolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.0001; <br />bdc: 0.0001; | PSNR: 29.8829 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703931255104-ee038d00-290e-4bc4-88e0-dad5c65670bc.png#averageHue=%23a5a3a1&clientId=u71f46a30-a87e-4&from=paste&height=499&id=ue4005fc7&originHeight=997&originWidth=1991&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1973641&status=done&style=none&taskId=u5de91ef6-c851-4d4b-9635-5478c02ecc1&title=&width=995.5) | <br />1. 有很多大块的高斯<br /> |
| --- | --- | --- | --- | --- |
| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_0.01_depthsmooth_0.0001_bdc_0.0001 | esolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.01; <br />depth smooth(edge perserving): 0.0001; <br />bdc: 0.0001; | PSNR: 29.7135 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703931893623-02bce4c6-b0f8-4e7b-81f5-e5c7e57d79bb.png#averageHue=%23a8a6a5&clientId=u71f46a30-a87e-4&from=paste&height=504&id=udd4c31c2&originHeight=1007&originWidth=1997&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1972084&status=done&style=none&taskId=u55fd6427-d798-47d9-828d-d8cf1d38dda&title=&width=998.5) |  |
| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_0.0001_depthsmooth_0.01_bdc_0.0001 | esolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.01; <br />bdc: 0.0001; | PSNR: 25.3184 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703932671384-66aab0f5-0d38-4742-b091-74e8d44e05dd.png#averageHue=%23a19f9e&clientId=u71f46a30-a87e-4&from=paste&height=500&id=ue956fd7a&originHeight=999&originWidth=1983&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2343931&status=done&style=none&taskId=uead49bd4-2936-4fc4-8d59-e4ab39150b8&title=&width=991.5) | <br />1. depth smooth loss 的权重调小就会出现很多 artifact<br /> |
| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_0.0001_depthsmooth_0.0001_bdc_0.0001_rand_beta | esolution: 4;<br />beta init: rand;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.0001; <br />bdc: 0.0001; | PSNR: 30.1266 | ![image.png](https://cdn.nlark.com/yuque/0/2023/png/22737144/1703933901691-92bced83-a1d4-4a28-955c-228b62ab8580.png#averageHue=%23a9a7a6&clientId=u71f46a30-a87e-4&from=paste&height=521&id=ue3f47c7e&originHeight=1041&originWidth=2003&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1981988&status=done&style=none&taskId=ub29735dd-b988-43b0-bf29-df588a96ce5&title=&width=1001.5) | <br />1. ref map 白色占比依旧很多；<br />2. 还是有大块高斯；<br /> |

调整需要 densify 时的 grad threshold 

| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_0.0001_depthsmooth_0.0001_bdc_0.0001_rand_beta_grad_thre_0.002 | esolution: 4;<br />beta init: rand;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.0001; <br />bdc: 0.0001;<br />densify_grad_threshold: 0.002; | PSNR: 26.9607 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704251009961-15b1d2c8-f10a-4746-871e-d6320a318132.png#averageHue=%23a4a19f&clientId=u6e84c747-b4d7-4&from=paste&height=505&id=ub2008087&originHeight=1009&originWidth=2047&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1900288&status=done&style=none&taskId=u45a385e9-19bf-4598-a7f9-a69f5740827&title=&width=1023.5) | <br />1. 效果变差<br /> |
| --- | --- | --- | --- | --- |
| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_0.0001_depthsmooth_0.0001_bdc_0.0001_rand_beta_grad_thre_0.00002 | esolution: 4;<br />beta init: rand;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.0001; <br />bdc: 0.0001;<br />densify_grad_threshold: 0.00002; | PSNR:  |  | OOM |
| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_0.0001_depthsmooth_0.0001_bdc_0.0001_rand_beta_grad_thre_0.0004 | esolution: 4;<br />beta init: rand;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.0001; <br />bdc: 0.0001;<br />densify_grad_threshold: 0.0004; | PSNR: 30.2793 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704258571292-f889d6ee-cb52-4f6b-ab60-c83fe1f64ebd.png#averageHue=%239d9b99&clientId=u86e9e830-7cd8-4&from=paste&height=498&id=u332d34c0&originHeight=995&originWidth=1979&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2010094&status=done&style=none&taskId=ub114e812-bad7-41ed-b05e-da2367f5a86&title=&width=989.5) | <br />1. 出现了大块的高斯<br /> |

调整 size threshold

| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_0.0001_depthsmooth_0.0001_bdc_0.0001_rand_beta_size_thre_10 | esolution: 4;<br />beta init: rand;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.0001; <br />bdc: 0.0001;<br />size_threshold: 10; | PSNR: 29.0378 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704258998697-d05b7ae1-5552-411c-87e4-22a1b688a287.png#averageHue=%23a5a3a1&clientId=u86e9e830-7cd8-4&from=paste&height=511&id=ud042a66e&originHeight=1021&originWidth=2019&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2030263&status=done&style=none&taskId=u4071b76c-fa51-44b7-99aa-d3fd08e1cf6&title=&width=1009.5) | <br />1. 还是有大块的高斯<br /> |
| --- | --- | --- | --- | --- |

去掉关于 ref alpha 的过滤

| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_0.0001_depthsmooth_0.0001_bdc_0.0001_rand_beta_wo_filter | esolution: 4;<br />beta init: rand;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.0001; <br />bdc: 0.0001; | PSNR: 24.8326 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704259856975-d13d195d-de63-409f-b463-703020529026.png#averageHue=%23a2a09e&clientId=u86e9e830-7cd8-4&from=paste&height=508&id=u151de062&originHeight=1015&originWidth=1993&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2125815&status=done&style=none&taskId=u54534f48-080d-4438-b0c8-8ae93e22820&title=&width=996.5) | <br />1. 没有出现明显的大块的高斯；<br />2. 但是渲染结果变差；<br />3. 对于 ref alpha 的过滤是导致大块高斯的原因？<br /> |
| --- | --- | --- | --- | --- |
| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_0.0001_depthsmooth_0.0001_bdc_0.0001_wo_filter | esolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.0001; <br />bdc: 0.0001; | PSNR: 22.2595 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704260952502-f576defe-81ea-4668-9143-33b8f2cd671e.png#averageHue=%239e9c9a&clientId=u86e9e830-7cd8-4&from=paste&height=500&id=ub72eee97&originHeight=999&originWidth=1997&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2150908&status=done&style=none&taskId=ue796b7c0-ed8b-47f6-a537-65efc3313c2&title=&width=998.5) | <br />1. 效果进一步变差<br /> |

将 ref alpha 的过滤条件修改<br />![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704265476970-237ecc2a-ad8c-4af0-be0c-169ca11b657c.png#averageHue=%23fefbfa&clientId=u86e9e830-7cd8-4&from=paste&height=229&id=u74e73e7b&originHeight=457&originWidth=2181&originalType=binary&ratio=2&rotation=0&showTitle=false&size=148304&status=done&style=none&taskId=ud23bb654-afa0-4f0a-ab30-f58a85c42dc&title=&width=1090.5)

| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_0.0001_depthsmooth_0.0001_bdc_0.0001_w_filter | esolution: 4;<br />beta init: 1;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.0001; <br />bdc: 0.0001; | PSNR: 30.3848 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704263650177-5f2da52b-9e3f-44de-b1d6-41b1fdcb85b7.png#averageHue=%23a4a2a0&clientId=u86e9e830-7cd8-4&from=paste&height=498&id=ue05a5c8b&originHeight=995&originWidth=1967&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1955602&status=done&style=none&taskId=u16631596-1efa-48d0-9071-753a750f800&title=&width=983.5) | <br />1. trans color 贡献度不够<br /> |
| --- | --- | --- | --- | --- |
| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_0.0001_depthsmooth_0.0001_bdc_0.0001_rand_beta_w_filter | esolution: 4;<br />beta init: rand;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.0001; <br />bdc: 0.0001; | PSNR: 30.7217 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704265024925-c2e3a7cd-83b2-4b73-b550-f479ae8250bc.png#averageHue=%23a5a3a2&clientId=u86e9e830-7cd8-4&from=paste&height=499&id=u3aacba1d&originHeight=997&originWidth=2043&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2040925&status=done&style=none&taskId=uc7ac576f-c930-4b72-b36b-8bd3766e451&title=&width=1021.5) |  |

计算 backward depth 时也加上 ref alpha 的过滤条件

| output/bookcase_r4_refl_iter_5000_init_1000_0.01_refmap_0.0001_depthsmooth_0.0001_bdc_0.0001_rand_beta_w_filter_1 | esolution: 4;<br />beta init: rand;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.0001; <br />bdc: 0.0001; | PSNR: 29.6282 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704266522978-0c02cc3b-492b-4ecd-96a8-b59899a59f1f.png#averageHue=%23a7a5a3&clientId=u86e9e830-7cd8-4&from=paste&height=513&id=u2a27586e&originHeight=1025&originWidth=1991&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2042453&status=done&style=none&taskId=ub9238bca-4e58-4b8f-a967-3f5084b21cf&title=&width=995.5) | <br />1. 没什么改善<br /> |
| --- | --- | --- | --- | --- |

<a name="eCEvk"></a>
#### iteration=30000
加上 depth smooth loss

| output/bookcase_r4_refl_init_1000_0.01_refmap_0.0001_depthsmooth_0.0001_rand_beta_wo_filter | esolution: 4;<br />beta init: rand;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.0001;  | PSNR: 30.7645 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704278294927-587a0e33-03c3-47fa-87f9-5f9781ad2d8e.png#averageHue=%23b7b5b4&clientId=ua8c80b52-580c-4&from=paste&height=535&id=ud5183fe4&originHeight=1069&originWidth=2049&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1989110&status=done&style=none&taskId=uaee1f2eb-b0e9-4aeb-98bf-5b2454b0a9a&title=&width=1024.5) | <br />1. 对比5000个iter，depth map 更加平滑<br /> |
| --- | --- | --- | --- | --- |
| output/bookcase_r4_refl_init_1000_0.01_refmap_0.0001_depthsmooth_0.001_rand_beta_wo_filter | esolution: 4;<br />beta init: rand;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.001;  | PSNR: 30.4109 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704281721127-15a6662f-4282-4107-a636-5e870315c9d6.png#averageHue=%23b5b3b2&clientId=ua8c80b52-580c-4&from=paste&height=534&id=ubc7d1a87&originHeight=1067&originWidth=2023&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2013657&status=done&style=none&taskId=u2f196c6c-7ba8-41d8-a328-591539c167b&title=&width=1011.5) |  |
| output/bookcase_r4_refl_init_1000_0.01_refmap_0.0001_depthsmooth_0.0001_rand_beta_wo_filter_ref_sh_0 | esolution: 4;<br />beta init: rand;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.0001; <br />ref sh degree: 始终为 0; | PSNR: 31.1430 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704283575886-be5db789-548f-4ca9-9d9b-f804740ea3c1.png#averageHue=%23b4b3b1&clientId=ua8c80b52-580c-4&from=paste&height=542&id=u2228cfc8&originHeight=1083&originWidth=2007&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1982841&status=done&style=none&taskId=u44880232-c24c-42d7-9d58-5ed6a15d21a&title=&width=1003.5) | <br />1. ref color 里有多余的光照，有一点效果？<br /> |
| output/bookcase_r4_refl_init_1000_0.01_refmap_0.0001_depthsmooth_0.0001_rand_beta_w_filter_ref_sh_0<br />（有 ref part 的 filter） | esolution: 4;<br />beta init: rand;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.0001; <br />ref sh degree: 始终为 0; | PSNR: 30.0105 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704341890108-baa22103-2422-4fa2-9df9-d60989938a57.png#averageHue=%23aeacaa&clientId=u2482a9a6-379f-4&from=paste&height=513&id=u9aaaa978&originHeight=1025&originWidth=1997&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1891228&status=done&style=none&taskId=u755e9b44-5da0-4a51-87ea-5d2be975138&title=&width=998.5) | <br />1. 效果对比不加好像变差<br /> |

加上 bdc loss

| output/bookcase_r4_refl_init_1000_0.01_refmap_0.0001_depthsmooth_0.0001_bdc_0.0001_rand_beta_wo_filter_ref_sh_0<br /> | esolution: 4;<br />beta init: rand;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0.0001; <br />bdc loss: 0.0001; <br />ref sh degree: 始终为 0; | PSNR: 21.6020 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704344940409-a3d8c1be-2322-4b45-990b-0fa5055f9de9.png#averageHue=%23a8a6a5&clientId=u2482a9a6-379f-4&from=paste&height=536&id=u53483372&originHeight=1071&originWidth=2005&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2191819&status=done&style=none&taskId=u0379daca-be79-4c5c-a80f-445adbbfef0&title=&width=1002.5) | <br />1. 效果变差很多<br /> |
| --- | --- | --- | --- | --- |

使用 warm-up training 策略

| output/bookcase_r4_refl_init_1000_0.01_rand_beta_wo_filter_ref_sh_0_schedule | esolution: 4;<br />beta init: rand;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0:**0.001**:1000:**0.01**:5000:**0.001**:30000; <br />bdc loss: 0:**0.0001**:5000:**0.005**:7000:**0.0001**:15000:**0**:30000; <br />ref sh degree: 始终为 0; | PSNR: 26.6122 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704361792242-01aee4c1-bbc7-4681-b1be-8891487df192.png#averageHue=%233a3129&clientId=u2482a9a6-379f-4&from=paste&height=491&id=u7c32efc2&originHeight=981&originWidth=1961&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2244679&status=done&style=none&taskId=ue2a8d9ac-dd4c-47ac-b368-7ca5d5f2ce6&title=&width=980.5) | <br />1. 相比于不使用 warm-up 有所提升，但是不多<br /> |
| --- | --- | --- | --- | --- |
| output/bookcase_r4_refl_init_1000_0.01_rand_beta_wo_filter_ref_sh_0_wo_ssim_schedule(loss 中不使用 ssim ) | esolution: 4;<br />beta init: rand;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0:**0.001**:1000:**0.01**:5000:**0.001**:30000; <br />bdc loss: 0:**0.0001**:5000:**0.005**:7000:**0.0001**:15000:**0**:30000; <br />ref sh degree: 始终为 0; | PSNR: 27.3934 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704362898488-8e4d2be3-a100-4f21-866f-a8056e50d8f4.png#averageHue=%239f9d9c&clientId=u2482a9a6-379f-4&from=paste&height=505&id=ud1c93d4c&originHeight=1009&originWidth=2011&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2245586&status=done&style=none&taskId=u03379807-dc3b-4881-8fb7-3f9cfd632af&title=&width=1005.5) | <br />1. metrics 提升；<br />2. 但是 render 效果依旧很差<br /> |
| output/bookcase_r4_refl_init_1000_0.01_rand_beta_wo_filter_ref_sh_0_wo_ssim_schedule(loss 中不使用 ssim；ref color 初始化为随机颜色) | esolution: 4;<br />beta init: rand;<br />reset: 0.1;<br />init: 1000(0.01);<br />ref map smooth: 0.0001; <br />depth smooth(edge perserving): 0:**0.001**:1000:**0.01**:5000:**0.001**:30000; <br />bdc loss: 0:**0.0001**:5000:**0.005**:7000:**0.0001**:15000:**0**:30000; <br />ref sh degree: 始终为 0; | PSNR: 25.9982 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704365581449-9b72a126-1c7c-4bf5-ad92-c4dec050e19f.png#averageHue=%239c9a99&clientId=u2482a9a6-379f-4&from=paste&height=521&id=u4a5c4187&originHeight=1041&originWidth=1991&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2198817&status=done&style=none&taskId=uf723f92b-c956-4b96-bbfd-032fb9ccb2a&title=&width=995.5) |  |
| output/bookcase_r4_refl_init_200_0.01_rand_beta_wo_filter_ref_sh_0_wo_ssim_rand_ref_schedule_1(loss 中不使用 ssim；ref color 初始化为随机颜色) | 调整了 scheduler<br />![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704367642216-7d295845-f94f-43a7-8221-f8cae9d36981.png#averageHue=%23fefefd&clientId=u2482a9a6-379f-4&from=paste&height=198&id=u95f27f14&originHeight=395&originWidth=1673&originalType=binary&ratio=2&rotation=0&showTitle=false&size=66567&status=done&style=none&taskId=uf9e9914c-f290-4922-829f-ac46c9445ff&title=&width=836.5)<br />![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704367648445-ccda0fce-7cea-41be-bea4-ed4ff63344da.png#averageHue=%23fdfcfb&clientId=u2482a9a6-379f-4&from=paste&height=258&id=uf4fb4c9b&originHeight=515&originWidth=1151&originalType=binary&ratio=2&rotation=0&showTitle=false&size=90478&status=done&style=none&taskId=u64bd7b17-78b6-425b-a029-67af7529d79&title=&width=575.5)<br />![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704367653609-51b6f17d-09cc-4503-8182-fb46c5c8ae78.png#averageHue=%23fefdfc&clientId=u2482a9a6-379f-4&from=paste&height=276&id=u91753fec&originHeight=551&originWidth=1027&originalType=binary&ratio=2&rotation=0&showTitle=false&size=89678&status=done&style=none&taskId=u5cc44c94-f82c-474a-9487-afc8be4f56c&title=&width=513.5) | PSNR: 28.9346 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704367590660-1055ff00-31fb-4039-8d35-1702045500de.png#averageHue=%23979593&clientId=u2482a9a6-379f-4&from=paste&height=499&id=iiwAx&originHeight=997&originWidth=2063&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2137850&status=done&style=none&taskId=u29677b39-7ac1-4ae9-aae3-37a54165bcd&title=&width=1031.5) |  |

fix backward 时 depth 微分计算的 bug<br />![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704367737486-be7a4c7e-73a6-497a-9818-5d3fae1f134a.png#averageHue=%23fefbfa&clientId=u2482a9a6-379f-4&from=paste&height=165&id=u8f15f7ee&originHeight=329&originWidth=2001&originalType=binary&ratio=2&rotation=0&showTitle=false&size=90723&status=done&style=none&taskId=u03987d4e-e524-4456-be66-e7221363abe&title=&width=1000.5)

| output/bookcase_r4_refl_init_200_0.01_rand_beta_wo_filter_ref_sh_0_wo_ssim_rand_ref_schedule_new(loss 中不使用 ssim；ref color 初始化为随机颜色) | 调整了 scheduler<br />![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704367642216-7d295845-f94f-43a7-8221-f8cae9d36981.png#averageHue=%23fefefd&clientId=u2482a9a6-379f-4&from=paste&height=198&id=lsQKT&originHeight=395&originWidth=1673&originalType=binary&ratio=2&rotation=0&showTitle=false&size=66567&status=done&style=none&taskId=uf9e9914c-f290-4922-829f-ac46c9445ff&title=&width=836.5)<br />![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704367648445-ccda0fce-7cea-41be-bea4-ed4ff63344da.png#averageHue=%23fdfcfb&clientId=u2482a9a6-379f-4&from=paste&height=258&id=fuR4N&originHeight=515&originWidth=1151&originalType=binary&ratio=2&rotation=0&showTitle=false&size=90478&status=done&style=none&taskId=u64bd7b17-78b6-425b-a029-67af7529d79&title=&width=575.5)<br />![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704367653609-51b6f17d-09cc-4503-8182-fb46c5c8ae78.png#averageHue=%23fefdfc&clientId=u2482a9a6-379f-4&from=paste&height=276&id=QX8R5&originHeight=551&originWidth=1027&originalType=binary&ratio=2&rotation=0&showTitle=false&size=89678&status=done&style=none&taskId=u5cc44c94-f82c-474a-9487-afc8be4f56c&title=&width=513.5) | PSNR: 28.6307 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704369491477-57f4158b-be5a-4950-ae7b-7da571580b91.png#averageHue=%239a9896&clientId=u2482a9a6-379f-4&from=paste&height=504&id=bOkA6&originHeight=1007&originWidth=2011&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2068691&status=done&style=none&taskId=u1ab9a418-8422-487c-9671-1103b1a671f&title=&width=1005.5) | <br />1. 没有奇怪的射线；<br />2. 但是效果也没变好<br /> |
| --- | --- | --- | --- | --- |
| output/bookcase_r4_refl_init_200_0.01_rand_beta_wo_filter_ref_sh_0_wo_ssim_rand_ref_schedule_new_1(loss 中不使用 ssim；ref color 初始化为随机颜色) | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704370539063-0fe8d57d-55c7-4c3c-a954-c409ef380140.png#averageHue=%23fefdfc&clientId=u2482a9a6-379f-4&from=paste&height=458&id=ud7ff7fae&originHeight=915&originWidth=1271&originalType=binary&ratio=2&rotation=0&showTitle=false&size=163959&status=done&style=none&taskId=u89122e8c-a21e-4260-8a01-3142baa9f4b&title=&width=635.5) | PSNR: 21.9690 | ![image.png](https://cdn.nlark.com/yuque/0/2024/png/22737144/1704371085674-610a1dbc-7178-46aa-916c-3a0e2fd84c94.png#averageHue=%23a1a09e&clientId=u2482a9a6-379f-4&from=paste&height=517&id=ue4a4be19&originHeight=1033&originWidth=2083&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1972644&status=done&style=none&taskId=uca134abd-fd91-4376-a32b-83e3a68f62c&title=&width=1041.5) | <br />1. 右边凭空多出来一部分柜子，很奇怪<br /> |

<a name="rkUIV"></a>
### TODOs

- [ ] color color 不用sh
- [x] beta 随机初始化
- [ ] check prune 和 densify 时的梯度问题
- [ ] 去掉 ssim loss
